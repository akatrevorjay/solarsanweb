{% if action == "list" %}
<script type="text/javascript">

if (typeof status_dataset_info_last_tab === 'undefined') var status_dataset_info_last_tab = 1;

$(".dataset_info_tabs").tabs({
    padding: 0,
    selected: (typeof status_dataset_info_last_tab === 'undefined') ? 1 : status_dataset_info_last_tab,
    //fx: { opacity: 'toggle', duration: 'fast' },
    spinner: '',
    select: function(event, ui) { status_dataset_info_last_tab = ui.index; },
});

</script>

<h3 class="ui-widget" style="margin: 0 0 0.5em 0; font-size: 1.2em; width: auto;">
    <div class="ui-widget-content" style="padding: 1em; color: #333;">
		{{ dataset }}

		<div class="right">test</div>
	</div>
</h3>

<div class="dataset_info_tabs ui-widget-content">
    <ul>
        {% set tabs = ['health', 'snapshots', 'cron', 'cluster', 'backup'] %}
        {% for t in tabs %}
        <li><a href="{{ url('solarsan.views.status_dataset_info', dataset=dataset.name, action=t) }}" title="{{ t }}"><span>{{ t|capitalize }}</span></a></li>
        {% endfor %}
    </ul>
    {% for t in tabs %}
    <div id="{{ t }}"></div>
    {% endfor %}
</div>
{% endif %}

{% if action == "health" %}
<pre>

	Pool "{{ dataset.pool.name }}"
		- Health: {{ dataset.pool.health }}


	Dataset:
       Used: {{ dataset.used }} / {{ dataset.available }}
		- By children: {{ dataset.usedbychildren }}
		- By snapshots: {{ dataset.usedbysnapshots }}
		
</pre>
{% endif %}

{% if action == "cluster" %}
    setup gluster mirror
{% endif %}

{% if action == "cron" %}
<script type="text/javascript">

$(".cronselect").each(function() {
	$(this).cron({
			onChange: function() {
				console.log('onchange');
		}});
});

</script>
<div style="min-height: 400px;">

<table>
	<tr>
		<td><h3>Automated Snapshots</h3></th>
		<td>Schedule</th>
	</tr>
	<tr>
		<td>
			<label for="cron_autosnap">Enable</label>
			<input type="checkbox" id="cron_autosnap" style="display: inline;" {% if dataset.cron.autosnap.enabled %}checked{% endif %}/>
		</td>
		<td>
			<div class="cronselect" style="display: inline;"></div>&nbsp;
			<a href="#" onclick="$(this).next().toggle().prev().toggle();">advanced</a>
			<input type="text" style="display: none;"/>
		</td>
	</tr>
	<tr>
		<td><h3>Integrated Online Backup</h3></td>
		<td>Schedule</td>
	</tr>
	<tr>
		<td>
			<label for="cron_backup">Enable</label>
			<input type="checkbox" id="cron_backup" {% if dataset.cron.backup.enabled %}checked{% endif %}/>
		</td>
		<td>
			<div class="cronselect" style="display: inline;"></div>&nbsp;
			<a href="#" onclick="$(this).next().toggle().prev().toggle();">advanced</a>
			<input type="text" style="display: none;"/>
		</td>
	</tr>
</table>

<div style="text-align: right">
	<input type="submit" value="Save" />
</div>

</div>
{% endif %}

{% if action == "backup" %}
<script type="text/javascript">

$(".online_backup").each(function() {
    // assign default values
    $("textarea, input", this).DefaultValue();

    // datasets drop
    $(".datasets", this).droppable({
            activeClass: "ui-state-hover",
            hoverClass: "ui-state-active",
            accept: ":not(.ui-sortable-helper)",
            drop: function( event, ui ) {
                $( this ).find( ".placeholder" ).remove();
                //console.log(ui);
                
                $( "<li></li>" ).text( ui.helper.text() ).button().css("padding", "5").appendTo(this);
                
                //$( "<div></div>" ).text( ui.draggable.find("a").text() ).button().appendTo( this );
            },
    }).sortable({
        items: "li:not(.placeholder)",
        tolerance: 'pointer',
        sort: function() {
            // gets added unintentionally by droppable interacting with sortable
            // using connectWithSortable fixes this, but doesn't allow you to customize active/hoverClass options
            $( this ).removeClass( "ui-state-default" );
        },
        //placeholder: "ui-state-highlight",
        //revert: true,
        //axis: 'x',
        //containment: 'parent',
    });
    //$(".datasets", this).disableSelection();
});

</script>

<div class="online_backup" style="padding: 10px;">
    enter in locsol backup key, drag and drop datasets from the left to backup<br />
    show graph with space available / remaining<br/>
    show backup status<br />
    <form>
        <input type="text" name="username" label="Username" />
        <textarea name="key" style="width: 100%" label="Online Backup Key"></textarea>
        <div class="datasets ui-state-default" style="width: 100%; height: 100px; overflow: hidden;" label="Datasets">
            <ul></ul>
        </div>
        <input type="submit" value="Save"/>
    </form>
</div>
{% endif %}

{% if action == "snapshots" %}

<table id="list1"></table>
<div id="pager1"></div>

<script type="text/javascript">

$("#list1").jqGrid({ url: '{{ url('solarsan.views.status_dataset_info', dataset=dataset.name, action="snapshots_xml_jqgrid") }}',
    datatype: "xml",
    colNames: ['Name', 'Created', 'Used', 'Avail' ],
    colModel: [
        {name:'name', index:'name'},
        {name:'created', index:'created', width: 110},
        {name:'used', index:'used', width: 25},
        {name:'available', index:'available', width: 25}, ],
    rowNum: 20, rowList: [10,20,30],
    autowidth: true,
    height: 250,
    pager: '#pager1',
    sortname: 'name',
    viewrecords: true,
    sortorder: "desc"}).navGrid('#pager1', {edit:false, add:true, del:true});

</script>
{% endif %}

{% if action == "snapshots_xml_jqgrid" %}
<rows>
    {% for snapshot in dataset.snapshots|sort(attribute='name') %}
    <row>
        <cell><![CDATA[{{ snapshot.basename }}]]></cell>
        <cell>{{ snapshot.creation }}</cell>
        <cell>{{ snapshot.used }}</cell>
        <cell>{{ dataset.available }}</cell>
    </row>
    {% endfor %}
</rows>
{% endif %}
