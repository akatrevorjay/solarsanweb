{% if action == "list" %}
<script type="text/javascript">

if (typeof status_dataset_info_last_tab === 'undefined') var status_dataset_info_last_tab = 1;

$(".dataset_info_tabs").tabs({
    padding: 0,
    selected: (typeof status_dataset_info_last_tab === 'undefined') ? 1 : status_dataset_info_last_tab,
    //fx: { opacity: 'toggle', duration: 'fast' },
    spinner: '',
    select: function(event, ui) { status_dataset_info_last_tab = ui.index; },
});
</script>

<h3>{{ dataset }}</h3>

<div class="dataset_info_tabs">
    <ul>
        {% load collect %}
        {% collect 'health' 'snapshots' 'cron' 'cluster' 'backup' as tabs %}
        {% for t in tabs %}
        <li><a href="{% url solarsan.views.status_dataset_info dataset=dataset.name action=t %}" title="{{ t }}"><span>{{ t|capfirst }}</span></a></li>
        {% endfor %}
    </ul>
    {% for t in tabs %}
    <div id="{{ t }}"></div>
    {% endfor %}
</div>
{% endif %}

{% if action == "health" %}
    not ok?
{% endif %}

{% if action == "cluster" %}
    setup gluster mirror
{% endif %}

{% if action == "cron" %}
    schedule snapshots, backups
{% endif %}

{% if action == "backup" %}
<script type="text/javascript">

$(".online_backup").each(function() {
    // assign default values
    $("textarea, input", this).DefaultValue();

    // datasets drop
    $(".datasets", this).droppable({
            activeClass: "ui-state-hover",
            hoverClass: "ui-state-active",
            drop: function( event, ui ) {
                $( this )
                    .addClass( "ui-state-highlight" )
                    .value( "Dropped!" );
            },
    });
/*
    $(".datasets").sortable({
            placeholder: "ui-state-highlight",
            items: 'div',
        });
    $(".datasets").disableSelection();
*/
});

</script>

<div class="online_backup" style="padding: 10px;">
    enter in locsol backup key, drag and drop datasets from the left to backup<br />
    show graph with space available / remaining<br/>
    show backup status<br />
    <form>
        <input type="text" name="username" label="Username" />
        <textarea name="key" style="width: 100%" label="Online Backup Key"></textarea>
        <div class="datasets" style="width: 100%; height: 50px;" label="Datasets"></div>
        <input type="submit" value="Save"/>
    </form>
</div>
{% endif %}

{% if action == "snapshots" %}

<table id="list1"></table>
<div id="pager1"></div>

<script type="text/javascript">

$("#list1").jqGrid({ url: '{% url solarsan.views.status_dataset_info dataset=dataset.name action="snapshots_xml_jqgrid" %}',
    datatype: "xml",
    colNames: ['Name', 'Created', 'Used', 'Avail' ],
    colModel: [
        {name:'name', index:'name'},
        {name:'created', index:'created', width: 110},
        {name:'used', index:'used', width: 25},
        {name:'available', index:'available', width: 25}, ],
    rowNum: 20, rowList: [10,20,30],
    autowidth: true,
    height: 250,
    pager: '#pager1',
    sortname: 'name',
    viewrecords: true,
    sortorder: "desc"}).navGrid('#pager1', {edit:false, add:true, del:true});

</script>
{% endif %}

{% if action == "snapshots_xml_jqgrid" %}
<rows>
    {% for snapshot in dataset.snapshots|dictsort:"name" %}
    <row>
        <cell><![CDATA[{{ snapshot.basename }}]]></cell>
        <cell>{{ snapshot.creation }}</cell>
        <cell>{{ snapshot.used }}</cell>
        <cell>{{ dataset.available }}</cell>
    </row>
    {% endfor %}
</rows>
{% endif %}
