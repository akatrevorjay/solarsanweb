{% extends "solarsan/base_site.html" %}

{% block content %}
<div id="content-main">

<script type="text/javascript">

// Graphs
var graphs = {};

$(function() {
    {% for pool in pools %}
    graphs['{{ pool }}'] = {};
    
    graphs['{{ pool }}']['graph_utilization'] = {
        type: 'pie',
        title: 'Utilization',
        width: 100, height: 100, radius: 75,
        legend_width: 40,
        opts: {
            legend: ["Free", "Used"],
            strokewidth: 3,
            stroke: "#000",
            colors: ["90-#7BCC55-#A7FB73", "45-#0B73D2-#0E99FA", "0-#E37201-#FC9B03"],
        },
        hover: graph_pie_hover, unhover: graph_pie_unhover, click: graph_pie_click,
    };
    
    graphs['{{ pool }}']['graph_iops'] = {
        type: 'line',
        title: 'IOPs',
        width: 600, height: 100,
    };
    
    graphs['{{ pool }}']['graph_throughput'] = {
        type: 'line',
        title: 'Throughput',
        width: 600, height: 100,
    };
    {% endfor %}
    
    // Update every 30s
    graphs_update_ajax("{% url solarsan.views.graph_stats_json %}", 30000, {});
});

// dataset_list
$(function() {

$("div.pool > div.dataset_list > div").each(function (i) {
    $(this).hover(function() {
            $(this).addClass("hover", "fast");
        }, function() {
            $(this).removeClass("hover", "fast");
        });
    $(this).click(function() {
        $(this).parent().children("div.selected").removeClass("selected", "fast");
        $(this).addClass("selected", "fast");

        $.ajax({type: "GET",
            url: "{% url solarsan.views.status_dataset_info %}/list/"+$(this).find('a:first').html(),
            context: $(this),
            }).done(function(data) { $(this).parent().parent().children("div.dataset_info").html(data); });
    });
    $(this).button();
});
$("div.pool > div.dataset_list > div:first-child").click();

$('div.pool > div.dataset_list').resizable({
    handles: "e",
});

$("#container > div").each(function(i) {
    $(this).center({inside: $("#container"), vertical: false})
    $(this).bind('resize', function() {
        $(this).center({inside: $("#container"), transition: 50, vertical: false});
    });
});

});

</script>

{% for pool in pools %}
<div class="pool" id="pool_{{ pool }}">
<h2>Storage Pool: {{ pool }}</h2>
    <div class="graphs">
        <div id="{{ pool }}__graph_utilization" class="ajax graphs_left"></div>
        <div id="{{ pool }}__graph_iops" class="ajax"></div>
        <div id="{{ pool }}__graph_throughput" class="ajax"></div>
    </div>
    <div class="dataset_list ui-widget-content">
            {% for dataset in pool.dataset_filesystems.all|dictsort:"name" %}
            <div>
                <a>{{ dataset }}</a><br />
                <div>{{ dataset.used }}/{{ dataset.available }}</div>
            </div>
            {% empty %}
            <div>
                <i>(none)</i>
            </div>
            {% endfor %}
            <div>
                <a>+ add dataset +</a>
            </div>
    </div>
    <div class="dataset_info ui-widget-content"></div>
</div>
{% empty %}
<h2>There are no storage pools?</h2>
{% endfor %}

{% endblock %}
