{% extends "base_site.html" %}
{% from "bootstrap/macros.html" import alert  %}
{% from "bootstrap/forms/macros.html" import field, input  %}

{% block css_extra %}
    <style></style>
{% endblock %}

{# Navbar is set in the app-specific override "base.html #}

{% block pre_content %}
{% endblock %}

{% block content %}

<div class="row">
    <div class="span12">
        <ul id="pool-breadcrumb" class="breadcrumb">
            <li class="static">
                <a href="/storage/pools">pools</a>
                <span class="divider">&raquo;</span>
            </li>
            {% include 'storage/pool_breadcrumb.html' %}
        </ul>
    </div>
</div>

<div class="row">
    <div class="span3">
        <div class="well sidebar-nav">
            <ul class="nav nav-list dataset-list">
                <li class="nav-header">Datasets</li>

                {% for dataset in pool.filesystems().order_by('name') %}
                    {% with dataset_path = dataset.path() %}
                    <li class="dataset-select"><a href="/storage/datasets/detail/{{ dataset.name|urlize }}" data-content="whoa" rel="tooltip" title="{{ dataset.used }} / {{ dataset.pool.size }}">
                            {% for path in dataset_path[1:] %}&nbsp;&nbsp;&nbsp;&nbsp;{% endfor %}
                            {{ dataset_path|last }}
                        </a></li>
                    {% endwith %}
                {% endfor %}

                <li><a href="#add-dataset-modal" data-toggle="modal" rel="tooltip" title="first tooltip"><span class="label label-info">add dataset</span></a></li>
            </ul>
        </div>
    </div>
    <div class="span9">
        <div id="dataset-info" style="padding-left: 10px">
            {% with dataset = pool.filesystem %}
                {% include 'storage/dataset_detail.html' %}
            {% endwith %}
        </div>
    </div>
</div>

<div class="modal fade hide" id="add-dataset-modal">
  <form class="form-horizontal">
    <fieldset>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">Ã—</button>
        <legend>Add new dataset to pool "{{ pool.name }}"</legend>
      </div>
      <div class="modal-body">
        <div class="control-group">
          <label class="control-label" for="name">Name</label>
          <div class="controls">
            <input type="text" class="input-xlarge" id="name">
            <p class="help-block">Allowed characters: [A-z0-9_/-]</p>
          </div>
          <label class="control-label" for="cluster">Clustered?</label>
          <div class="controls">
            <input type="checkbox" class="input-xlarge" id="cluster" checked="checked">
          </div>
        </div>
      </div>
    </fieldset>
  </form>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Close</a>
    <a href="#" class="btn btn-primary">Add</a>
  </div>
</div>

<script type="text/javascript">
/* ___________
 * pool_detail
 */
$(function() {

/*
 * dataset-select
 */

function dataset_click_apply() {
    $(".dataset-select").not('.dataset-select-clickery').click(function(event) {
        event.preventDefault();

        $(this).parent().children(".active").removeClass("active", "fast");
        $(this).addClass("active");

        $.ajax({type: "GET",
            url: $(this).find('a:first').attr('href'),
            context: $(this),
            }).done(function(data) {
                $("#dataset-info").html(data);
                var breadcrumb_html = $('#dataset-info .pool-breadcrumb-replace ul').html();
                $('#dataset-info .pool-breadcrumb-replace ul li').not('.static').remove();
                $("#pool-breadcrumb li").not('.static').remove();
                $("#pool-breadcrumb").append(breadcrumb_html);
                delete breadcrumb_html;

                dataset_click_apply();
            });
        }).addClass('dataset-select-clickery')
          .children('a').tooltip({placement: 'right'});
}
dataset_click_apply();

// Act as if the first dataset has been clicked
$(".dataset-list .dataset-select").first().addClass('active'); //click();


});
</script>

{% endblock %}

